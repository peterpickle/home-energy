{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home Energy - Prices</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="{% static 'home_energy/manifest.json' %}" />
    <link rel="icon" href="{% static 'home_energy/favicon.ico' %}" sizes="any">
    <link rel="apple-touch-icon" href="{% static 'home_energy/apple-touch-icon.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'home_energy/usage.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>

    function getAllPrices() {
        url = "{% url 'home-energy:get_all_prices' %}";
        $.getJSON(url,
            function(result) {
                $("#prices_div").html("");
                for(i in result) {
                    addPriceDiv(result[i]);
                }
            }
        );
    }

    function formatEpochInSec(epoch) {
        date = new Date(epoch * 1000);
        return date.toLocaleDateString()
    }

    function addPriceDiv(price) {
        html = "<div id='" + price.id + "'>";
        html += price.id + " " + formatEpochInSec(price.starttime) + " " + price.down_high + " " + price.up_high + " " + price.peak_down
        html += "</div>";
        $("#prices_div").append(html)
    }

    window.onload = function() {
        //getAllPrices();

        /*$("#set_boost_60_min_btn").click(function() {
            doAction("boost_60_min");
        });*/
    }

    </script>
</head>
<body>
    <h1>Prices</h1>
    </br>
    <a href="{% url 'home-energy:usage' %}">Usage</a>
    <br/>
    <div id="add_price_div">
        <form action="{% url 'home-energy:add_price' %}" method="post">
            {% csrf_token %}
            <table>
                {{ add_price_form.as_table }}
            </table>
            <input type="submit" value="Add">
        </form>
    </div>
    <div id="prices_div">
    {% for modify_price_form in modify_price_forms %}
        <div id="{{ price.id }}">
            <form action="{% url 'home-energy:modify_price' %}" method="post">
                {% csrf_token %}
                <table>
                    {{ modify_price_form.as_table }}
                </table>
                <input type="submit" value="Modify">
            </form>
            <form action="{% url 'home-energy:remove_price' %}" method="post">
                {% csrf_token %}
                {{ modify_price_form.id }}
                <input type="submit" value="Remove">
            </form>
        </div>
    {% endfor %}
    </div>
</body>
</html>
